CREATE DATABASE CMTU;

USE CMTU;

CREATE TABLE USUARIO (
    ID_USUARIO INTEGER PRIMARY KEY AUTO_INCREMENT,
    STATUS BOOLEAN DEFAULT TRUE,
    NOME VARCHAR(255),
    E_MAIL VARCHAR(255) UNIQUE,
    SENHA VARCHAR(100),
    ADMIN BOOLEAN DEFAULT FALSE
);

CREATE TABLE MODULO (
    ID_MODULO INTEGER PRIMARY KEY AUTO_INCREMENT,
    STATUS BOOLEAN DEFAULT TRUE,
    NOME_MODULO VARCHAR(100),
    PORCENTAGEM_NECESSARIA INTEGER
);

CREATE TABLE CERTIFICADO (
    ID_CERTIFICADO INTEGER PRIMARY KEY AUTO_INCREMENT,
    STATUS BOOLEAN DEFAULT TRUE,
    DATA_CONCLUSAO DATE,
    HORAS TIME,
    FK_USUARIO_ID_USUARIO INTEGER
);

CREATE TABLE ATIVIDADE (
    ID_ATIVIDADE INTEGER PRIMARY KEY AUTO_INCREMENT,
    STATUS BOOLEAN DEFAULT TRUE,
    RESPOSTA_CERTA INTEGER,
    NOME VARCHAR(100),
    TEXTO TEXT,
    ERRO INTEGER,
    ACERTO INTEGER,
    FK_MODULO_ID_MODULO INTEGER
);

CREATE TABLE ALTERNATIVA (
    ID_ALTERNATIVA INTEGER PRIMARY KEY AUTO_INCREMENT,
    STATUS BOOLEAN DEFAULT TRUE,
    TEXTO VARCHAR(255),
    FK_ATIVIDADE_ID_ATIVIDADE INTEGER,
);

CREATE TABLE USUARIO_MODULO (
    ID_USUARIO_MODULO INTEGER PRIMARY KEY AUTO_INCREMENT,
    PORCENTAGEM_CONCLUIDO INTEGER,
    FK_MODULO_ID_MODULO INTEGER,
    FK_USUARIO_ID_USUARIO INTEGER,
    INICIADO BOOLEAN DEFAULT FALSE
);
 
ALTER TABLE CERTIFICADO ADD CONSTRAINT FK_CERTIFICADO_USUARIO
    FOREIGN KEY (FK_USUARIO_ID_USUARIO)
    REFERENCES USUARIO (ID_USUARIO)
    ON DELETE CASCADE;
 
ALTER TABLE ATIVIDADE ADD CONSTRAINT FK_ATIVIDADE_MODULO
    FOREIGN KEY (FK_MODULO_ID_MODULO)
    REFERENCES MODULO (ID_MODULO)
    ON DELETE RESTRICT;
 
ALTER TABLE ALTERNATIVA ADD CONSTRAINT FK_ALTERNATIVA_ATIVIDADE
    FOREIGN KEY (FK_ATIVIDADE_ID_ATIVIDADE)
    REFERENCES ATIVIDADE (ID_ATIVIDADE)
    ON DELETE RESTRICT;
 
ALTER TABLE USUARIO_MODULO ADD CONSTRAINT FK_USUARIO_MODULO_MODULO
    FOREIGN KEY (FK_MODULO_ID_MODULO)
    REFERENCES MODULO (ID_MODULO)
    ON DELETE RESTRICT;
 
ALTER TABLE USUARIO_MODULO ADD CONSTRAINT FK_USUARIO_MODULO_USUARIO
    FOREIGN KEY (FK_USUARIO_ID_USUARIO)
    REFERENCES USUARIO (ID_USUARIO)
    ON DELETE SET NULL;